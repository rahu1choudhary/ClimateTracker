id: fetch-weather-flow
namespace: weather.team

inputs:
  - id: city
    type: STRING
    required: true
    description: Name of the city to fetch weather data for.

tasks:
  - id: weather-fetch-task
    type: io.kestra.plugin.scripts.python.Commands
    beforeCommands:
      - pip install requests redis
    namespaceFiles:
      enabled: true
      include:
        - fetch_weather.py
    commands:
      - python fetch_weather.py "{{ inputs.city }}"

  - id: trigger-api-call
    type: io.kestra.plugin.core.http.Request
    uri: http://localhost:8080/api/v1/executions/weather.team/fetch-weather
    method: POST
    contentType: multipart/form-data
    formData:
      city: "{{ inputs.city }}"
